jQuery(function($){'use strict';function show($el){$el.removeClass('quiz-is-hidden')}
function hide($el){$el.addClass('quiz-is-hidden')}
var Quiz=function($el){this.$el=$el};Quiz.prototype={init:function(){this.initDom();this.initUI();this.addListeners()},initDom:function(){this.$questions=this.$el.find('.quiz__question');this.$prev=this.$el.find('.quiz__control--prev');this.$next=this.$el.find('.quiz__control--next');this.$complete=this.$el.find('.quiz__control--complete');this.$result=this.$el.find('.quiz__result')},initUI:function(){this.current=0;hide(this.$questions);show(this.$questions.first())},addListeners:function(){var quiz=this;this.$el.on('click','input',function(){quiz.isLast()?show(quiz.$complete):show(quiz.$next)});this.$prev.on('click',function(event){event.preventDefault();if(quiz.isFirst()){return}
hide(quiz.$questions.eq(quiz.current));quiz.current --;show(quiz.$questions.eq(quiz.current));quiz.isFirst()&&hide(quiz.$prev);show(quiz.$next);hide(quiz.$complete)});this.$next.on('click',function(event){event.preventDefault();if(quiz.isLast()){return}
hide(quiz.$questions.eq(quiz.current));quiz.current ++;show(quiz.$questions.eq(quiz.current));show(quiz.$prev);quiz.isCurrentAnswered()&&!quiz.isLast()?show(quiz.$next):hide(quiz.$next);quiz.isCurrentAnswered()&&quiz.isLast()?show(quiz.$complete):hide(quiz.$complete)});this.$complete.on('click',function(event){quiz.submit(event,quiz)})},submit:function(event,quiz){event.preventDefault();quiz.$prev.remove();quiz.$next.remove();quiz.$complete.remove();hide(quiz.$result.empty());$.post(MBQuiz.ajaxUrl,{action:'mb_quiz_check_result',_ajax_nonce:MBQuiz.nonceCheckResult,data:quiz.$el.find('input').serialize(),quiz_id:quiz.$complete.data('quiz_id')},function(response){quiz.showResult.call(quiz,response)},'json')},showResult:function(response){if(!response.success){alert(response.data);return}
show(this.$result.html(response.data.message));$(document).trigger('mb-quiz-complete')},isFirst:function(){return 0===this.current},isLast:function(){return this.$questions.length-1===this.current},isCurrentAnswered:function(){return this.$questions.eq(this.current).find('input:checked').length>0}};$('.quiz').each(function(){var quiz=new Quiz($(this));quiz.init()})})